function panierEmpty(){return null==objetLocalStorage||0==objetLocalStorage}let cart=document.querySelector(".card-panier__commande"),objetLocalStorage=JSON.parse(localStorage.getItem("products"));function main(){panier(),totalPanier(),viderPanier(),formulaire()}function panier(){let e=document.querySelector(".width-vide-panier"),t=(document.querySelector(".card-panier"),document.querySelector(".panier-vide"));localStorage.getItem("products")&&(t.style.display="none");for(let t in objetLocalStorage){let a=document.createElement("div");cart.insertBefore(a,e),a.classList.add("row","card-panier__commande","description-teddie","mb-2");let l=document.createElement("img");a.appendChild(l),l.classList.add("col","card-panier__commande"),l.src=objetLocalStorage[t].image,l.style=style="width:10%;";let c=document.createElement("div");a.appendChild(c),c.classList.add("col","card-panier__commande"),c.innerHTML=objetLocalStorage[t].name;let r=document.createElement("div");a.appendChild(r),r.classList.add("col","card-panier__commande","title-colors"),r.innerHTML=objetLocalStorage[t].colors;let o=document.createElement("div");a.appendChild(o),o.classList.add("col","card-panier__commande","price"),o.innerHTML=objetLocalStorage[t].price+" €"}}function totalPanier(){let e=[];if(0==panierEmpty())for(let t=0;t<objetLocalStorage.length;t++){let a=objetLocalStorage[t].price;e.push(a)}const t=e.reduce((e,t)=>e+t,0);document.querySelector(".total").textContent="Total : "+t+" €"}function viderPanier(){document.querySelector(".vide-panier").addEventListener("click",()=>{localStorage.clear()})}function formulaire(){function e(e){return/^[a-zA-ZéèîïÉÈÎÏ][A-zéèêàçîï]+([-'\s][a-zA-ZéèîïÉÈÎÏ][a-zéèêàçîï]+)?$/.test(e)}function t(e){return/^(([0-8][0-9])|(9[0-5]))[0-9]{3}$/.test(e)}function a(e){return/^\d+\s[A-z]+\s[A-z]+/.test(e)}function l(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function c(e){return/^[+](\d{3})\)?(\d{3})(\d{5,6})$|^(\d{10,10})$/.test(e)}const r=document.querySelector("#submit");let o=document.querySelector("#prenom");o.addEventListener("change",function(t){e(o.value)?(document.querySelector("#prenom_valide").textContent=" Champ Valide !",document.querySelector("#prenom_valide").className="champ_valide text-success font-weight-bold far fa-check-circle"):(document.querySelector("#prenom_valide").textContent=" Veuillez à bien remplir ce champ merci !",document.querySelector("#prenom_valide").className="champ_valide text-danger font-weight-bold far fa-times-circle",alert("Aucun chiffre ou symbole ne sont autorisés pour les champs : Prénom, Nom et Ville"),t.preventDefault())});let n=document.querySelector("#nom");n.addEventListener("change",function(t){e(n.value)?(document.querySelector("#nom_valide").textContent=" Champ Valide !",document.querySelector("#nom_valide").className="champ_valide text-success font-weight-bold far fa-check-circle"):(document.querySelector("#nom_valide").textContent=" Veuillez à bien remplir ce champ merci !",document.querySelector("#nom_valide").className="champ_valide text-danger font-weight-bold far fa-times-circle",alert("Aucun chiffre ou symbole ne sont autorisés pour les champs : Prénom, Nom et Ville"),t.preventDefault())});let i=document.querySelector("#cp");i.addEventListener("change",function(e){t(i.value)?(document.querySelector("#cp_valide").textContent=" Champ Valide !",document.querySelector("#cp_valide").className="champ_valide text-success font-weight-bold far fa-check-circle"):(document.querySelector("#cp_valide").textContent=" Veuillez à bien remplir ce champ merci !",document.querySelector("#cp_valide").className="champ_valide text-danger font-weight-bold far fa-times-circle",alert("Merci d'inscrire un Code Postal valide"),e.preventDefault())});let d=document.querySelector("#ville");d.addEventListener("change",function(t){e(d.value)?(document.querySelector("#ville_valide").textContent=" Champ Valide !",document.querySelector("#ville_valide").className="champ_valide text-success font-weight-bold far fa-check-circle"):(document.querySelector("#ville_valide").textContent=" Veuillez à bien remplir ce champ merci !",document.querySelector("#ville_valide").className="champ_valide text-danger font-weight-bold far fa-times-circle",alert("Aucun chiffre ou symbole ne sont autorisés pour les champs : Prénom, Nom et Ville"),t.preventDefault())});let u=document.querySelector("#adresse");u.addEventListener("change",function(e){a(u.value)?(document.querySelector("#adresse_valide").textContent=" Champ Valide !",document.querySelector("#adresse_valide").className="champ_valide text-success font-weight-bold far fa-check-circle"):(document.querySelector("#adresse_valide").textContent=" Veuillez à bien remplir ce champ merci !",document.querySelector("#adresse_valide").className="champ_valide text-danger font-weight-bold far fa-times-circle",alert("Merci d'inscrire une Adresse valide"),e.preventDefault())});let m=document.querySelector("#mail");m.addEventListener("change",function(e){l(m.value)?(document.querySelector("#mail_valide").textContent=" Champ Valide !",document.querySelector("#mail_valide").className="champ_valide text-success font-weight-bold far fa-check-circle"):(document.querySelector("#mail_valide").textContent=" Veuillez à bien remplir ce champ merci !",document.querySelector("#mail_valide").className="champ_valide text-danger font-weight-bold far fa-times-circle",alert("Merci d'inscrire une Adresse Mail valide"),e.preventDefault())});let s=document.querySelector("#telephone");s.addEventListener("change",function(e){c(s.value)?(document.querySelector("#telephone_valide").textContent=" Champ Valide !",document.querySelector("#telephone_valide").className="champ_valide text-success font-weight-bold far fa-check-circle"):(document.querySelector("#telephone_valide").textContent=" Veuillez à bien remplir ce champ merci !",document.querySelector("#telephone_valide").className="champ_valide text-danger font-weight-bold far fa-times-circle",alert("Merci d'inscrire un numéro de Téléphone valide"),e.preventDefault())});let p=document.querySelector(".erreur");r.addEventListener("click",r=>{if(o.value&&n.value&&i.value&&d.value&&u.value&&m.value&&s.value&&1!=panierEmpty()){if(e(o.value)&&e(n.value)&&t(i.value)&&e(d.value)&&a(u.value)&&l(m.value)&&c(s.value)){let e=[];for(let t in objetLocalStorage){let a=objetLocalStorage[t]._id;e.push(a)}console.log(e);const t={contact:{firstName:o.value,lastName:n.value,address:u.value,city:d.value,email:m.value},products:e};console.log(t);let a=document.querySelector(".total").innerText;a=a.split(" :"),fetch("http://localhost:3000/api/teddies/order",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{localStorage.clear();let t=e.orderId;console.log(t),localStorage.setItem("name",o.value),localStorage.setItem("total",a[1]),localStorage.setItem("orderId",e.orderId),document.location.href="confirmation.html"}).catch(e=>{alert("Il y a eu une erreur : "+e)})}}else p.innerHTML="Vous devez renseigner tous les champs pour finaliser votre commande ou votre panier est vide !"})}main();